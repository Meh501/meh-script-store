<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body { font-family:sans-serif; background: linear-gradient(to right, #243b55, #141e30); padding:20px; color:white; min-height: 100vh; }
        .container { max-width:600px; margin:auto; background:rgba(255,255,255,0.05); backdrop-filter:blur(10px); padding:20px; border-radius:15px; border:1px solid rgba(255,255,255,0.1); }
        .rev { border-bottom:1px solid rgba(255,255,255,0.1); padding:15px 0; position:relative; }
        .owner-tag { color:#d4af37; font-weight:bold; background:rgba(212,175,55,0.1); padding:2px 8px; border-radius:5px; border:1px solid #d4af37; font-size:13px; }
        .del-btn { position:absolute; left:0; color:#ff4d4d; cursor:pointer; font-size:12px; border:1px solid #ff4d4d; padding:2px 5px; border-radius:4px; }
        textarea { width:100%; padding:12px; border-radius:8px; border:none; margin-top:20px; background:white; color: black; outline: none; box-sizing: border-box;}
        .btn { background:#007bff; color:white; border:none; padding:12px; border-radius:8px; cursor:pointer; margin-top:10px; width:100%; font-weight:bold; }
    </style>
</head>
<body>
    <div class="container">
        <h2 style="text-align:center;">â­ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h2>
        <div id="list"></div>
        <hr>
        <h3>Ø£Ø¶Ù ØªÙ‚ÙŠÙŠÙ…Ùƒ</h3>
        <textarea id="msg" placeholder="Ø§ÙƒØªØ¨ Ø±Ø£ÙŠÙƒ Ù‡Ù†Ø§..."></textarea>
        <button class="btn" onclick="add()">Ù†Ø´Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</button>
        <center><br><a href="activate.html" style="color:#00d4ff; text-decoration:none; font-weight: bold;">â¬…ï¸ Ø§Ù„Ø¹ÙˆØ¯Ø©</a></center>
    </div>
    <script>
        const currentUser = localStorage.getItem('user');
        async function load() {
            const res = await fetch('/get-reviews');
            const data = await res.json();
            document.getElementById('list').innerHTML = data.map(r => `
                <div class="rev">
                    ${currentUser === 'Meh' ? `<span class="del-btn" onclick="del(${r.id})">Ø­Ø°Ù</span>` : ''}
                    <b>${r.user}</b> ${r.user === 'Meh' ? '<span class="owner-tag">Ø§Ù„Ù…Ø§Ù„Ùƒ ğŸ‘‘</span>' : ''}
                    <p style="margin-top:10px;">${r.comment}</p>
                </div>`).join('');
        }
        async function add() {
            if(!localStorage.getItem('bought') && currentUser !== 'Meh') return Swal.fire({ icon: 'info', title: 'ØªÙ†Ø¨ÙŠÙ‡', text: 'ÙŠØ¬Ø¨ Ø§Ù„Ø´Ø±Ø§Ø¡ Ø£ÙˆÙ„Ø§Ù‹ Ù„ØªØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„ØªÙ‚ÙŠÙŠÙ…' });
            await fetch('/add-review', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({user:currentUser, comment:document.getElementById('msg').value}) });
            document.getElementById('msg').value=""; load();
            Swal.fire({ icon: 'success', title: 'ØªÙ… Ø§Ù„Ù†Ø´Ø±', timer: 1500, showConfirmButton: false });
        }
        async function del(id) {
            Swal.fire({ title: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ', text: "Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹!", icon: 'warning', showCancelButton: true, confirmButtonColor: '#ff4d4d', cancelButtonColor: '#6c757d', confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù', cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡' }).then(async (result) => {
                if (result.isConfirmed) {
                    await fetch('/delete-review', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({id, adminUser: currentUser})});
                    load();
                    Swal.fire('ØªÙ… Ø§Ù„Ø­Ø°Ù!', 'ØªÙ… Ø­Ø°Ù Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­.', 'success');
                }
            });
        }
        load();
    </script>
</body>
</html>